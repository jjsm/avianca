CREATE TABLE empleados(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	nombre varchar2(100) NULL,
	apellido varchar2(100) NULL,
	sexo char(1) NULL,
	fecha_nacimiento date NULL,
	fecha_ingreso date NULL,
	fecha_retiro date NULL,
	direccion varchar2(100) NULL,
	email varchar2(100) NULL,
	celular varchar2(15) NULL,
	ubicacion_actual varchar2(100) NULL,
	cantidad_horas_vuelo smallint NULL,
	fecha_ultimo_vuelo date NULL,
	estado_empleado varchar2(100) NULL,
	tipo_empleado varchar2(100) NULL,
	fecha_ultimo_entrenamiento date NULL,
    CONSTRAINT PK_empleados PRIMARY KEY (id),
    CONSTRAINT check_sexo CHECK (sexo IN ('M','F')),
    CONSTRAINT check_estado_empleado CHECK (estado_empleado IN ('EN VUELO', 'ACTIVO', 'INACTIVO', 'JUBILADO','SUSPENDIDO','DESPEDIDO','ENTRENAMIENTO','LICENCIA','VACACIONES')),
    CONSTRAINT check_tipo_empleado CHECK (tipo_empleado IN ('Pilotos', 'Auxiliares de Servicio'))
);

CREATE TABLE pilotos(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	nivel_ingles nchar(20) NULL,
	tipo_licencia nchar(10) NULL,
	cargo_piloto nchar(20) NULL,
	empleado_id number NULL,
    CONSTRAINT PK_pilotos PRIMARY KEY (id),
    CONSTRAINT check_nivel_ingles CHECK (nivel_ingles IN ('Pre-elementary', 'Elementary','Pre-Operational','Operational','Extended','Expert')),
    CONSTRAINT check_cargo_piloto CHECK (cargo_piloto IN ('Comandante', 'Primer Oficial')),
    CONSTRAINT check_tipo_licencia CHECK (tipo_licencia IN ('CPL', 'IFR', 'ME', 'ATPL'))
);

CREATE TABLE licencias_pilotos(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	piloto_id number NULL,
	descripcion_tipo_licencia nchar(10) NULL,
    CONSTRAINT PK_licencias_pilotos PRIMARY KEY (id),
    CONSTRAINT check_desc_tipo_licencia CHECK (descripcion_tipo_licencia IN ('CPL', 'IFR', 'ME', 'ATPL'))
);

CREATE TABLE tipos_aviones(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	descripcion varchar2(50) NULL,
    CONSTRAINT PK_tipos_aviones PRIMARY KEY (id)  
);

CREATE TABLE modelos_aviones(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	tipo_avion_id number NULL,
	modelo_general varchar2(100) NULL,
	modelo_especifico varchar2(100) NULL,
	capacidad_ejecutiva number NULL,
	capacidad_economica number NULL,
    CONSTRAINT PK_modelos_aviones PRIMARY KEY (id) 
);

CREATE TABLE aviones(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	matricula varchar2(50) NULL,
	numero_serial varchar2(50) NULL,
	edad smallint NULL,
	modelo_avion_id smallint NOT NULL,
    CONSTRAINT PK_aviones PRIMARY KEY (id)
);

CREATE TABLE pasajeros(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	nombre varchar2(100) NULL,
	apellido varchar2(100) NULL,
	identificacion varchar2(100) NULL,
	tipo_documento varchar2(100) NULL,
    CONSTRAINT PK_pasajeros PRIMARY KEY (id),
    CONSTRAINT check_tipo_documento CHECK (tipo_documento IN ('CC', 'PP', 'DNI', 'CE'))
);

CREATE TABLE aeropuertos(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	ciudad varchar2(100) NULL,
	abreviacion varchar2(100) NULL,
	nombre varchar2(100) NULL,
	latitud binary_double NULL,
	longitud binary_double NULL,
	pais varchar2(100) NULL,
    CONSTRAINT PK_aeropuertos PRIMARY KEY (id) 
);

CREATE TABLE rutas(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	distancia number NULL,
	cantidad_promedio_horas number NULL,
	aeropuerto_origen_id number NOT NULL,
	aeropuerto_destino_id number NOT NULL,
    CONSTRAINT PK_rutas PRIMARY KEY (id) 
);


CREATE TABLE vuelos(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	ruta_id number NULL,
	numero_vuelo number NULL,
	frecuencia_semanal number NULL,
	tripulantes_requeridos number NULL,
	tipo_avion_id number NOT NULL,
    CONSTRAINT PK_vuelos PRIMARY KEY (id) 
);

CREATE TABLE itinerarios(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	fecha_salida_estimada date NULL,
	fecha_llegada_estimada date NULL,
	fecha_salida_real date NULL,
	fecha_llegada_real date NULL,
	duracion_real number NULL,
	cantidad_pasajeros smallint NULL,
	vuelo_id number NULL,
	avion_id number NULL,
	piloto_id number NULL,
	copiloto_id number NULL,
    CONSTRAINT PK_itinerarios PRIMARY KEY (id)
);

CREATE TABLE log_vuelos(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	timestamp timestamp NULL,
	fecha_utc date NULL,
	latitud binary_double NULL,
	longitud binary_double NULL,
	velocidad number NULL,
	direccion varchar2(100) NULL,
	altitud number NULL,
	itinerario_id number NULL,
    CONSTRAINT PK_log_vuelos PRIMARY KEY (id) 
);

CREATE TABLE checkin(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	itinerario_id number NULL,
	pasajero_id number NULL,
	nro_confimacion_checkin number NULL,
	contacto_emergencia varchar2(100) NULL,
	ciudad_contacto_emergencia varchar2(100) NULL,
	pais_contacto_emergencia varchar2(100) NULL,
	correo_contacto_emergencia varchar2(100) NULL,
	telefono_contacto_emergencia varchar2(14) NULL,
	confirmacion_checkin char(1) NULL,
    CONSTRAINT PK_checkin PRIMARY KEY (id),
    CONSTRAINT check_confirmacion_checkin CHECK (confirmacion_checkin IN ('1','0'))
);

CREATE TABLE tripulantes(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	itinerario_id number NULL,
	empleado_id number NULL,
    CONSTRAINT PK_tripulantes PRIMARY KEY (id) 
);

ALTER TABLE aviones ADD CONSTRAINT FK_aviones__modelos_aviones FOREIGN KEY (modelo_avion_id) REFERENCES modelos_aviones(id);
ALTER TABLE checkin ADD CONSTRAINT FK_checkin__itinerarios FOREIGN KEY(itinerario_id) REFERENCES itinerarios (id);
ALTER TABLE checkin ADD CONSTRAINT FK_checkin__pasajeros FOREIGN KEY(pasajero_id) REFERENCES pasajeros (id);
ALTER TABLE itinerarios ADD CONSTRAINT FK_itinerarios__aviones FOREIGN KEY(avion_id) REFERENCES aviones (id);
ALTER TABLE itinerarios ADD CONSTRAINT FK_itinerarios__pilotos FOREIGN KEY(piloto_id) REFERENCES pilotos (id);
ALTER TABLE itinerarios ADD CONSTRAINT FK_itinerarios__copilotos FOREIGN KEY(copiloto_id) REFERENCES pilotos (id);
ALTER TABLE itinerarios ADD CONSTRAINT FK_itinerarios__vuelos FOREIGN KEY(vuelo_id) REFERENCES vuelos (id);
ALTER TABLE licencias_pilotos ADD CONSTRAINT FK_licencias_pilotos__pilotos FOREIGN KEY(piloto_id) REFERENCES pilotos (id);
ALTER TABLE log_vuelos ADD CONSTRAINT FK_log_vuelos__itinerarios FOREIGN KEY(itinerario_id) REFERENCES itinerarios (id);
ALTER TABLE modelos_aviones ADD CONSTRAINT FK_mod_aviones_tipo_avione FOREIGN KEY(tipo_avion_id) REFERENCES tipos_aviones (id);
ALTER TABLE pilotos  ADD CONSTRAINT FK_pilotos__empleados FOREIGN KEY(empleado_id) REFERENCES empleados (id);
ALTER TABLE rutas ADD CONSTRAINT FK_rutas__aeropuerto_origen FOREIGN KEY(aeropuerto_origen_id) REFERENCES aeropuertos (id);
ALTER TABLE rutas ADD CONSTRAINT FK_rutas__aeropuertos_destino FOREIGN KEY(aeropuerto_destino_id) REFERENCES aeropuertos (id);
ALTER TABLE tripulantes ADD CONSTRAINT FK_tripulantes__empleados FOREIGN KEY(empleado_id) REFERENCES empleados (id);
ALTER TABLE tripulantes ADD CONSTRAINT FK_tripulantes__itinerarios FOREIGN KEY(itinerario_id) REFERENCES itinerarios (id);
ALTER TABLE vuelos ADD CONSTRAINT FK_vuelos__rutas FOREIGN KEY(ruta_id) REFERENCES rutas (id);
ALTER TABLE vuelos ADD CONSTRAINT FK_vuelos__tipos_aviones FOREIGN KEY(tipo_avion_id) REFERENCES tipos_aviones (id);
